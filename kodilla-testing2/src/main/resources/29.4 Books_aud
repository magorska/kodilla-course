USE kodilla;

CREATE TABLE BOOKS_AUD (
                           EVENT_ID INT(11) NOT NULL AUTO_INCREMENT,
                           EVENT_DATE DATETIME NOT NULL,
                           EVENT_TYPE VARCHAR(10) DEFAULT NULL,
                           BOOK_ID INT(11) NOT NULL,
                           OLD_TITLE VARCHAR(255),
                           NEW_TITLE VARCHAR(255),
                           OLD_PUBYEAR INT(8),
                           NEW_PUBYEAR INT(8),
                           OLD_BESTSELLER DATETIME,
                           NEW_BESTSELLER DATETIME,
                           PRIMARY KEY (EVENT_ID)
);

#AFTER INSERT
DELIMITER $$
CREATE TRIGGER BOOKS_INSERT AFTER INSERT ON books
    FOR EACH ROW
BEGIN
    INSERT INTO BOOKS_AUD(EVENT_DATE, BOOK_ID, NEW_TITLE, NEW_PUBYEAR, NEW_BESTSELLER)
                          VALUE(CURTIME(), 'INSERT', NEW.TITLE, NEW.PUBYEAR, NEW.BESTSELLER);
END $$
DELIMITER ;

#AFTER DELETE
DELIMITER $$
CREATE TRIGGER BOOKS_DELETE AFTER DELETE ON books
    FOR EACH ROW
BEGIN
    INSERT INTO BOOKS_AUD(EVENT_DATE, EVENT_TYPE, BOOK_ID)
    VALUE (CURTIME(), 'DELETE', OLD.BOOK_ID);
END$$
DELIMITER ;

#AFTER UPDATE
DELIMITER $$
CREATE TRIGGER BOOKS_UPDATE AFTER UPDATE ON books
    FOR EACH ROW
BEGIN
    INSERT INTO BOOKS_AUD(EVENT_DATE, EVENT_TYPE, BOOK_ID, OLD_TITLE,
                          NEW_TITLE, OLD_PUBYEAR, NEW_PUBYEAR, OLD_BESTSELLER, NEW_BESTSELLER)
    VALUE(CURTIME(),'UPDATE', NEW.BOOK_ID , OLD.TITLE, NEW.TITLE, OLD.PUBYEAR, NEW.PUBYEAR, OLD.BESTSELLER, NEW.BESTSELLER);
END $$
DELIMITER ;